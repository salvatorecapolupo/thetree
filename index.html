<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tree Sorting Game</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .tree-container, .shuffled-container {
      min-height: 200px;
      border: 2px dashed #ccc;
      padding: 10px;
      margin-bottom: 20px;
    }
    .node {
      padding: 8px 12px;
      margin: 5px;
      background-color: #f8f9fa;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: grab;
    }
    .valid {
      background-color: #d4edda !important;
    }
    .invalid {
      background-color: #f8d7da !important;
    }
  </style>
</head>
<body>
<div class="container py-4">
  <h2 class="text-center mb-4">Tree Sorting Game</h2>
  <div class="row">
    <div class="col-md-6">
      <h4>Shuffled Nodes</h4>
      <div id="shuffled" class="shuffled-container d-flex flex-wrap"></div>
    </div>
    <div class="col-md-6">
      <h4>Your Tree</h4>
      <div id="tree" class="tree-container d-flex flex-wrap"></div>
    </div>
  </div>
  <div class="text-center">
    <button class="btn btn-primary" onclick="validateTree()">Valida</button>
    <p id="score" class="mt-3 font-weight-bold"></p>
  </div>
</div>

<script>
  const correctTree = [
    { id: 1, label: 'Root', parent: null },
    { id: 2, label: 'Child 1', parent: 1 },
    { id: 3, label: 'Child 2', parent: 1 },
    { id: 4, label: 'Subchild 1', parent: 2 },
    { id: 5, label: 'Subchild 2', parent: 2 },
  ];

  let shuffledTree = [...correctTree].sort(() => Math.random() - 0.5);

  function createNodeElement(node) {
    const div = document.createElement('div');
    div.classList.add('node');
    div.setAttribute('draggable', true);
    div.setAttribute('data-id', node.id);
    div.innerText = node.label;
    div.addEventListener('dragstart', e => {
      e.dataTransfer.setData('text/plain', node.id);
    });
    return div;
  }

  function allowDrop(e) {
    e.preventDefault();
  }

  function handleDrop(e, target) {
    e.preventDefault();
    const id = e.dataTransfer.getData('text/plain');
    const dragged = document.querySelector(`[data-id='${id}']`);
    if (!target.contains(dragged)) target.appendChild(dragged);
  }

  function renderNodes() {
    const shuffledContainer = document.getElementById('shuffled');
    const treeContainer = document.getElementById('tree');
    shuffledContainer.innerHTML = '';
    treeContainer.innerHTML = '';

    shuffledTree.forEach(node => {
      const el = createNodeElement(node);
      shuffledContainer.appendChild(el);
    });

    shuffledContainer.addEventListener('dragover', allowDrop);
    shuffledContainer.addEventListener('drop', e => handleDrop(e, shuffledContainer));

    treeContainer.addEventListener('dragover', allowDrop);
    treeContainer.addEventListener('drop', e => handleDrop(e, treeContainer));
  }

  function validateTree() {
    const userNodes = Array.from(document.getElementById('tree').children);
    let score = 0;
    userNodes.forEach((el, index) => {
      const id = parseInt(el.dataset.id);
      if (correctTree[index] && correctTree[index].id === id) {
        el.classList.add('valid');
        el.classList.remove('invalid');
        score++;
      } else {
        el.classList.add('invalid');
        el.classList.remove('valid');
      }
    });
    const percentage = Math.round((score / correctTree.length) * 100);
    document.getElementById('score').innerText = `Punteggio: ${percentage}%`;
  }

  renderNodes();
</script>
</body>
</html>
